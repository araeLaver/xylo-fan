# XYLO ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

> ì‘ì„±ì¼: 2025-01-07
> ëŒ€ìƒ: ì „ì²´ ê°œë°œíŒ€
> ëª©ì : ì‹œìŠ¤í…œ ì „ì²´ êµ¬ì¡° ë° ì»´í¬ë„ŒíŠ¸ ê°„ í†µì‹  ì„¤ê³„

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#1-ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨](#2-ì•„í‚¤í…ì²˜-ë‹¤ì´ì–´ê·¸ë¨)
3. [ì»´í¬ë„ŒíŠ¸ ìƒì„¸](#3-ì»´í¬ë„ŒíŠ¸-ìƒì„¸)
4. [ë°ì´í„° í”Œë¡œìš°](#4-ë°ì´í„°-í”Œë¡œìš°)
5. [ë³´ì•ˆ ì„¤ê³„](#5-ë³´ì•ˆ-ì„¤ê³„)
6. [í™•ì¥ì„± ì „ëµ](#6-í™•ì¥ì„±-ì „ëµ)

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 ì „ì²´ êµ¬ì¡°

XYLOëŠ” **3-Tier ì•„í‚¤í…ì²˜** + **ë¸”ë¡ì²´ì¸ ë ˆì´ì–´**ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Web Frontend â”‚  â”‚ Admin Panel  â”‚  â”‚ Mobile (í–¥í›„) â”‚  â”‚
â”‚  â”‚   React.js   â”‚  â”‚   Next.js    â”‚  â”‚ React Native â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†• HTTPS/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Application Layer                     â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                      â”‚  NestJS API  â”‚                    â”‚
â”‚                      â”‚   Gateway    â”‚                    â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â†“                â†“                â†“             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Auth     â”‚  â”‚   Points   â”‚  â”‚ Blockchain â”‚       â”‚
â”‚  â”‚  Module    â”‚  â”‚   Module   â”‚  â”‚   Module   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  YouTube   â”‚  â”‚ Leaderboardâ”‚  â”‚   Events   â”‚       â”‚
â”‚  â”‚  Module    â”‚  â”‚   Module   â”‚  â”‚   Module   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†•                  â†•                  â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL  â”‚  â”‚    Redis     â”‚  â”‚     Bull     â”‚  â”‚
â”‚  â”‚   (Koyeb)    â”‚  â”‚   (Cache)    â”‚  â”‚ (Job Queue)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†• Web3/ethers.js
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Blockchain Layer                      â”‚
â”‚                  (Polygon Mumbai/Mainnet)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ XYLOUserPass â”‚  â”‚ XYLONFTCol-  â”‚  â”‚   RWAVault   â”‚  â”‚
â”‚  â”‚   (SBT)      â”‚  â”‚   lection    â”‚  â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†• API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   External Services                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ X (Twitter)  â”‚  â”‚  YouTube API â”‚  â”‚   Discord    â”‚  â”‚
â”‚  â”‚  OAuth 1.0a  â”‚  â”‚   Data v3    â”‚  â”‚   Webhooks   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ê¸°ìˆ  ìŠ¤íƒ ìš”ì•½

| ë ˆì´ì–´ | ê¸°ìˆ  | ë²„ì „ |
|--------|------|------|
| **Frontend** | React.js + TypeScript | 18.x |
| **Backend** | NestJS + TypeScript | 11.x |
| **Database** | PostgreSQL (Koyeb) | 15 |
| **Cache** | Redis | 7 |
| **Queue** | Bull (Redis ê¸°ë°˜) | 4.12.x |
| **Blockchain** | Solidity + ethers.js | 0.8.20 / 6.x |
| **Network** | Polygon Mumbai/Mainnet | 80001 / 137 |

---

## 2. ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

### 2.1 ì‚¬ìš©ì í”Œë¡œìš° (íšŒì›ê°€ì…)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ 1. "Continue with X" í´ë¦­
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NestJS Auth     â”‚
â”‚  Module          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 2. OAuth Request URL ìƒì„±
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  X (Twitter)     â”‚
â”‚  OAuth Server    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 3. ì‚¬ìš©ì ìŠ¹ì¸
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Callback        â”‚
â”‚  /auth/callback  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 4. Access Token ë°œê¸‰
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL      â”‚
â”‚  users í…Œì´ë¸”    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 5. ê³„ì • ìƒì„± + referralCode ë°œê¸‰
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  X API           â”‚
â”‚  Post Tweet      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 6. ìë™ í¬ìŠ¤íŒ… (ë ˆí¼ëŸ´ ë§í¬ í¬í•¨)
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JWT Token       â”‚
â”‚  Response        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 í¬ì¸íŠ¸ ê³„ì‚° í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YouTube         â”‚
â”‚  Shorts ì—…ë¡œë“œ   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ ë§¤ì¼ 00:00 UTC+9
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bull Queue      â”‚
â”‚  "youtube-crawl" â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Job ì‹¤í–‰
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YouTube API v3  â”‚
â”‚  /videos.list    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ ë¹„ë””ì˜¤ ì •ë³´ ì¡°íšŒ
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL      â”‚
â”‚  youtube_videos  â”‚
â”‚  + snapshots     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ ì „ë‚ ê³¼ ë¹„êµí•˜ì—¬ ì¦ê°€ë¶„ ê³„ì‚°
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Point           â”‚
â”‚  Calculation     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ ì¡°íšŒìˆ˜ +100 â†’ +1P
     â”‚ ì¢‹ì•„ìš” +50  â†’ +1P
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  point_          â”‚
â”‚  transactions    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ INSERT INTO
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Trigger:        â”‚
â”‚  update_user_    â”‚
â”‚  points()        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ user_points ìë™ ì—…ë°ì´íŠ¸
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis           â”‚
â”‚  Sorted Set      â”‚
â”‚  "leaderboard"   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ ZADD user:id score
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Blockchain      â”‚
â”‚  XYLOUserPass    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ updateSlotValue(tokenId, SLOT_CONTENT, newValue)
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event Emitted   â”‚
â”‚  PointsUpdated   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 NFT ë°œí–‰ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ 1. "Claim User Pass" í´ë¦­
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend        â”‚
â”‚  /nfts/prepare   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 2. ë©”íƒ€ë°ì´í„° ìš”ì²­
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend         â”‚
â”‚  NFT Module      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 3. user_points ì¡°íšŒ
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 4. í¬ì¸íŠ¸ ë°ì´í„° ë°˜í™˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Metadata ìƒì„±   â”‚
â”‚  (attributes)    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 5. contractAddress + metadata ë°˜í™˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend        â”‚
â”‚  MetaMask í˜¸ì¶œ   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 6. ì‚¬ìš©ì ì„œëª…
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  XYLOUserPass    â”‚
â”‚  Contract        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 7. mintUserPass(userAddress)
     â”‚ ê°€ìŠ¤ë¹„ ì§€ë¶ˆ ($0.05)
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Transaction     â”‚
â”‚  Confirmed       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 8. txHash + tokenId
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend         â”‚
â”‚  /nfts/confirm   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 9. user_nfts ì €ì¥
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL      â”‚
â”‚  user_nfts       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 10. NFT ë°œí–‰ ì™„ë£Œ
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend        â”‚
â”‚  NFT ì¹´ë“œ í‘œì‹œ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ì»´í¬ë„ŒíŠ¸ ìƒì„¸

### 3.1 Backend Modules

#### Auth Module
```typescript
@Module({
  imports: [
    PassportModule.register({ defaultStrategy: 'jwt' }),
    JwtModule.register({
      secret: process.env.JWT_SECRET,
      signOptions: { expiresIn: '7d' }
    })
  ],
  controllers: [AuthController],
  providers: [
    AuthService,
    TwitterStrategy,
    JwtStrategy
  ]
})
export class AuthModule {}
```

**ì—­í• **:
- X(íŠ¸ìœ„í„°) OAuth 1.0a ë¡œê·¸ì¸
- JWT í† í° ë°œê¸‰/ê²€ì¦
- ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ ë°œì†¡
- ì§€ê°‘ ì—°ë™ ì„œëª… ê²€ì¦

#### YouTube Module
```typescript
@Module({
  imports: [BullModule.registerQueue({ name: 'youtube-crawl' })],
  controllers: [YouTubeController],
  providers: [
    YouTubeService,
    YouTubeProcessor,  // Bull Queue Processor
    YouTubeApiClient
  ]
})
export class YouTubeModule {}
```

**ì—­í• **:
- ì±„ë„ ì¸ì¦ (ì¸ì¦ì½”ë“œ ë°©ì‹)
- YouTube Data API v3 ì—°ë™
- ìˆì¸  í¬ë¡¤ë§ (ë§¤ì¼ 00:00 ìŠ¤ì¼€ì¤„ë§)
- íƒœê·¸ ê¸°ë°˜ í•„í„°ë§ (#WITCHES, #XYLO)

#### Points Module
```typescript
@Module({
  imports: [RedisModule],
  controllers: [PointsController],
  providers: [
    PointsService,
    PointsCalculator,
    LeaderboardService
  ]
})
export class PointsModule {}
```

**ì—­í• **:
- í¬ì¸íŠ¸ ê³„ì‚° (SLOT-01~06)
- point_transactions ê¸°ë¡
- user_points ì§‘ê³„
- Redis ë¦¬ë”ë³´ë“œ ì—…ë°ì´íŠ¸

#### Blockchain Module
```typescript
@Module({
  controllers: [BlockchainController],
  providers: [
    BlockchainService,
    SBTContractService,
    NFTContractService,
    VaultContractService,
    EthersProvider
  ]
})
export class BlockchainModule {}
```

**ì—­í• **:
- ethers.js ì´ˆê¸°í™”
- ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ í˜¸ì¶œ
- íŠ¸ëœì­ì…˜ ëª¨ë‹ˆí„°ë§
- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë‹

### 3.2 Database ì—°ê²°

```typescript
// prisma.service.ts
@Injectable()
export class PrismaService extends PrismaClient {
  constructor() {
    super({
      datasources: {
        db: {
          url: process.env.DATABASE_URL
        }
      },
      log: ['query', 'info', 'warn', 'error']
    });
  }

  async onModuleInit() {
    await this.$connect();
  }

  async onModuleDestroy() {
    await this.$disconnect();
  }
}
```

**í™˜ê²½ë³€ìˆ˜ (DATABASE_URL)**:
```
postgresql://unble:password@ep-divine-bird-a1f4mly5.ap-southeast-1.pg.koyeb.app:5432/unble?schema=xylo&sslmode=require
```

### 3.3 Redis ìºì‹±

```typescript
// redis.config.ts
export const redisConfig: RedisModuleOptions = {
  config: {
    host: process.env.REDIS_HOST || 'localhost',
    port: parseInt(process.env.REDIS_PORT) || 6379,
    password: process.env.REDIS_PASSWORD,
    db: 0
  }
};

// ì‚¬ìš© ì˜ˆì‹œ: ë¦¬ë”ë³´ë“œ
async updateLeaderboard(userId: string, totalPoints: number) {
  await this.redis.zadd('leaderboard:all', totalPoints, userId);
  await this.redis.zadd('leaderboard:1d', totalPoints, userId);
  await this.redis.expire('leaderboard:1d', 86400); // 24ì‹œê°„
}

async getTop10() {
  return this.redis.zrevrange('leaderboard:all', 0, 9, 'WITHSCORES');
}
```

### 3.4 Bull Queue (ì‘ì—… í)

```typescript
// youtube.processor.ts
@Processor('youtube-crawl')
export class YouTubeProcessor {
  @Process('crawl-all-channels')
  async handleCrawl(job: Job) {
    const channels = await this.prisma.youtubeChannel.findMany({
      where: { isVerified: true }
    });

    for (const channel of channels) {
      await this.crawlChannelVideos(channel.channelId);
    }
  }

  @Cron('0 0 * * *', { timeZone: 'Asia/Seoul' })
  async scheduleCrawl() {
    await this.queue.add('crawl-all-channels', {}, {
      attempts: 3,
      backoff: { type: 'exponential', delay: 60000 }
    });
  }
}
```

---

## 4. ë°ì´í„° í”Œë¡œìš°

### 4.1 ì½ê¸° ì‘ì—… (Read Path)

```
User Request â†’ NestJS Controller â†’ Service Layer
                                        â†“
                                  Redis Cache?
                                   â†™       â†˜
                              Cache Hit   Cache Miss
                                 â†“           â†“
                              Return    PostgreSQL Query
                                           â†“
                                      Save to Cache
                                           â†“
                                        Return
```

**ìºì‹± ì „ëµ**:
| ë°ì´í„° | TTL | í‚¤ íŒ¨í„´ |
|--------|-----|---------|
| ë¦¬ë”ë³´ë“œ | 5ë¶„ | `leaderboard:{period}` |
| ì‚¬ìš©ì í”„ë¡œí•„ | 1ì‹œê°„ | `user:{userId}:profile` |
| ìœ íŠœë¸Œ ë¹„ë””ì˜¤ | 1ì‹œê°„ | `youtube:video:{videoId}` |
| NFT ë©”íƒ€ë°ì´í„° | 24ì‹œê°„ | `nft:{tokenId}:metadata` |

### 4.2 ì“°ê¸° ì‘ì—… (Write Path)

```
User Request â†’ NestJS Controller â†’ Service Layer
                                        â†“
                                  PostgreSQL Write
                                        â†“
                                  Invalidate Cache
                                        â†“
                                  Emit Event
                                   â†™       â†˜
                          Redis Update   Blockchain Update
                                              (ë¹„ë™ê¸°)
```

**Write-Through íŒ¨í„´**:
- DB ì“°ê¸° ì„±ê³µ í›„ ìºì‹œ ë¬´íš¨í™”
- ë‹¤ìŒ ì½ê¸° ìš”ì²­ ì‹œ ìºì‹œ ì¬êµ¬ì¶•

### 4.3 ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜

```typescript
// events/points-updated.event.ts
export class PointsUpdatedEvent {
  constructor(
    public readonly userId: string,
    public readonly category: string,
    public readonly amount: number
  ) {}
}

// points.service.ts
async addPoints(userId: string, category: string, amount: number) {
  // 1. DB ì—…ë°ì´íŠ¸
  await this.prisma.pointTransaction.create({ ... });

  // 2. ì´ë²¤íŠ¸ ë°œí–‰
  this.eventEmitter.emit('points.updated', new PointsUpdatedEvent(
    userId, category, amount
  ));
}

// blockchain.listener.ts
@OnEvent('points.updated')
async handlePointsUpdated(event: PointsUpdatedEvent) {
  // SBT ì—…ë°ì´íŠ¸ (ë¹„ë™ê¸°)
  const tokenId = await this.getTokenId(event.userId);
  const slot = this.getSlotByCategory(event.category);
  const newValue = await this.calculateNewValue(tokenId, slot);

  await this.sbtContract.updateSlotValue(tokenId, slot, newValue);
}
```

---

## 5. ë³´ì•ˆ ì„¤ê³„

### 5.1 ì¸ì¦/ì¸ê°€

```typescript
// JWT Guard
@Injectable()
export class JwtAuthGuard extends AuthGuard('jwt') {
  canActivate(context: ExecutionContext) {
    return super.canActivate(context);
  }
}

// Role Guard
@Injectable()
export class RolesGuard implements CanActivate {
  canActivate(context: ExecutionContext): boolean {
    const requiredRoles = this.reflector.get<string[]>('roles', context.getHandler());
    const request = context.switchToHttp().getRequest();
    const user = request.user;

    return requiredRoles.some(role => user.roles?.includes(role));
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
@Controller('admin')
@UseGuards(JwtAuthGuard, RolesGuard)
export class AdminController {
  @Get('users')
  @Roles('ADMIN')
  async getAllUsers() { ... }
}
```

### 5.2 Rate Limiting

```typescript
// rate-limit.config.ts
export const rateLimitConfig = {
  global: { ttl: 60, limit: 100 },      // ë¶„ë‹¹ 100 ìš”ì²­
  auth: { ttl: 300, limit: 5 },         // 5ë¶„ë‹¹ 5 ë¡œê·¸ì¸ ì‹œë„
  youtube: { ttl: 3600, limit: 1000 },  // ì‹œê°„ë‹¹ 1000 YouTube API í˜¸ì¶œ
  blockchain: { ttl: 60, limit: 10 }    // ë¶„ë‹¹ 10 íŠ¸ëœì­ì…˜
};

// main.ts
app.use(rateLimit({
  windowMs: 60 * 1000,
  max: 100,
  message: 'Too many requests from this IP'
}));
```

### 5.3 ì…ë ¥ ê²€ì¦

```typescript
// DTOs with class-validator
export class CreateUserDto {
  @IsString()
  @MinLength(3)
  @MaxLength(50)
  name: string;

  @IsEmail()
  email: string;

  @IsEthereumAddress()
  @IsOptional()
  walletAddress?: string;
}

// Pipe
@UsePipes(new ValidationPipe({ whitelist: true, forbidNonWhitelisted: true }))
```

### 5.4 í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬

```bash
# .env (ì ˆëŒ€ Gitì— ì»¤ë°‹ ê¸ˆì§€!)
NODE_ENV=production
PORT=3000

# Database
DATABASE_URL=postgresql://...

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# JWT
JWT_SECRET=your-super-secret-key-change-this
JWT_EXPIRES_IN=7d

# Twitter OAuth
TWITTER_CONSUMER_KEY=
TWITTER_CONSUMER_SECRET=
TWITTER_CALLBACK_URL=

# YouTube
YOUTUBE_API_KEY=

# Blockchain
POLYGON_RPC_URL=https://polygon-rpc.com
PRIVATE_KEY=0x...
SBT_CONTRACT_ADDRESS=0x...
NFT_CONTRACT_ADDRESS=0x...
VAULT_CONTRACT_ADDRESS=0x...
```

---

## 6. í™•ì¥ì„± ì „ëµ

### 6.1 ìˆ˜í‰ í™•ì¥ (Horizontal Scaling)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Load   â”‚
â”‚  Balancerâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â†’ NestJS Instance 1
     â”œâ”€â”€â”€â”€â†’ NestJS Instance 2
     â”œâ”€â”€â”€â”€â†’ NestJS Instance 3
     â””â”€â”€â”€â”€â†’ NestJS Instance N
           â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Shared   â”‚
     â”‚ Redis    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë¬´ìƒíƒœ ì„¤ê³„ (Stateless)**:
- ì„¸ì…˜ì€ Redisì— ì €ì¥
- JWT í† í° ì‚¬ìš© (ì„œë²„ ë©”ëª¨ë¦¬ ë¶ˆí•„ìš”)
- Bull QueueëŠ” Redis ê¸°ë°˜ (ì¸ìŠ¤í„´ìŠ¤ ê°„ ê³µìœ )

### 6.2 ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

**Read Replica**:
```typescript
// prisma.service.ts
export class PrismaService {
  primary: PrismaClient;  // ì“°ê¸°
  replica: PrismaClient;  // ì½ê¸°

  async findMany(...) {
    return this.replica.user.findMany(...);  // Replica ì‚¬ìš©
  }

  async create(...) {
    return this.primary.user.create(...);    // Primary ì‚¬ìš©
  }
}
```

**Connection Pooling**:
```
DATABASE_URL=postgresql://...?connection_limit=20&pool_timeout=10
```

### 6.3 ìºì‹± ê³„ì¸µ

```
Layer 1: Browser Cache (Static Assets)
   â†“
Layer 2: CDN (Cloudflare)
   â†“
Layer 3: Redis (Application Cache)
   â†“
Layer 4: PostgreSQL (Source of Truth)
```

### 6.4 ë¹„ë™ê¸° ì²˜ë¦¬

**Bull Queue í™œìš©**:
```typescript
// ë¬´ê±°ìš´ ì‘ì—…ì€ Queueë¡œ ì²˜ë¦¬
await this.queue.add('send-email', { userId, type: 'welcome' });
await this.queue.add('update-blockchain', { tokenId, slotValues });
await this.queue.add('generate-report', { userId, period });
```

### 6.5 ëª¨ë‹ˆí„°ë§

```typescript
// health.controller.ts
@Controller('health')
export class HealthController {
  @Get()
  @HealthCheck()
  check() {
    return this.health.check([
      () => this.db.pingCheck('database'),
      () => this.redis.pingCheck('redis'),
      () => this.blockchain.pingCheck('polygon')
    ]);
  }
}
```

**ë©”íŠ¸ë¦­ ìˆ˜ì§‘**:
- **Prometheus** + **Grafana**: API ì‘ë‹µ ì‹œê°„, ì—ëŸ¬ìœ¨
- **Bull Board**: Queue ëª¨ë‹ˆí„°ë§
- **PostgreSQL Logs**: ìŠ¬ë¡œìš° ì¿¼ë¦¬ ë¶„ì„

---

## 7. ë°°í¬ ì•„í‚¤í…ì²˜

### 7.1 ê°œë°œ í™˜ê²½

```
Developer Machine
  â†“
Docker Compose
  â”œâ”€â”€ NestJS (localhost:3000)
  â”œâ”€â”€ PostgreSQL (localhost:5432)
  â”œâ”€â”€ Redis (localhost:6379)
  â””â”€â”€ Hardhat Node (localhost:8545)
```

### 7.2 í”„ë¡œë•ì…˜ í™˜ê²½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Cloudflare (CDN + DDoS)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Load Balancer (Koyeb/Vercel)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
        â†“               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NestJS API 1  â”‚ â”‚ NestJS API 2  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL (Koyeb Managed)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis (Upstash/Railway)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Polygon Mainnet (Alchemy RPC) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ì‘ì„±ì**: Architecture Team
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-01-07
**ë¬¸ì„œ ë²„ì „**: 1.0
